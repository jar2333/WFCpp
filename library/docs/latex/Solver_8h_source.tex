\hypertarget{Solver_8h_source}{}\doxysection{Solver.\+h}
\label{Solver_8h_source}\index{include/Solver.h@{include/Solver.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{2 }
\DoxyCodeLine{3 \textcolor{preprocessor}{\#include <Tile.h>}}
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include <Grid.h>}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <Position.h>}}
\DoxyCodeLine{6 }
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <map>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <set>}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <list>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <functional>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <unordered\_set>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <unordered\_map>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <stack>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include <utility>}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include <tuple>}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include <optional>}}
\DoxyCodeLine{19 \textcolor{preprocessor}{\#include <iterator>}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#include <algorithm>}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#include <cstdlib>}}
\DoxyCodeLine{22 \textcolor{preprocessor}{\#include <stdexcept>}}
\DoxyCodeLine{23 }
\DoxyCodeLine{24 }
\DoxyCodeLine{25 \textcolor{keyword}{template} <>}
\DoxyCodeLine{26 \textcolor{keyword}{struct }std::hash<\mbox{\hyperlink{structPosition}{Position}}> \{}
\DoxyCodeLine{27   std::size\_t operator()(\textcolor{keyword}{const} \mbox{\hyperlink{structPosition}{Position}}\& k)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{28     \textcolor{keywordflow}{return} (k.y << 16) \string^ k.x;}
\DoxyCodeLine{29   \}}
\DoxyCodeLine{30 \};}
\DoxyCodeLine{31 \textcolor{keyword}{template} <>}
\DoxyCodeLine{32 \textcolor{keyword}{struct }std::hash<std::pair<size\_t, Direction>> \{}
\DoxyCodeLine{33   std::size\_t operator()(\textcolor{keyword}{const} std::pair<size\_t, Direction>\& k)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{34     \textcolor{keywordflow}{return} k.first \string^ (size\_t)k.second;}
\DoxyCodeLine{35   \}}
\DoxyCodeLine{36 \};}
\DoxyCodeLine{37 }
\DoxyCodeLine{38 }
\DoxyCodeLine{74 \textcolor{keyword}{class }\mbox{\hyperlink{classSolver}{Solver}} \{}
\DoxyCodeLine{75 \textcolor{keyword}{public}:}
\DoxyCodeLine{76 }
\DoxyCodeLine{80   \textcolor{keyword}{typedef} \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{classSolver_a624d11307b449d2e13dee24ec5170eed}{TileKey}};}
\DoxyCodeLine{81 }
\DoxyCodeLine{82   \textcolor{keyword}{typedef} std::function<std::vector<TileKey>::const\_iterator(\textcolor{keyword}{const} std::vector<TileKey>\&)> CollapseBehavior;}
\DoxyCodeLine{83 }
\DoxyCodeLine{84   \textcolor{keyword}{typedef} std::function<void(\textcolor{keyword}{const} \mbox{\hyperlink{classSolver_a624d11307b449d2e13dee24ec5170eed}{TileKey}}\&, \mbox{\hyperlink{structPosition}{Position}})> CollapseCallback;}
\DoxyCodeLine{85   \textcolor{keyword}{typedef} std::function<void(\textcolor{keyword}{const} std::vector<TileKey>\&, \mbox{\hyperlink{structPosition}{Position}})> PropagateCallback;}
\DoxyCodeLine{86 }
\DoxyCodeLine{91   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} std::list<CollapseCallback>::iterator \mbox{\hyperlink{classSolver_abc55f3b23ccda7c353df7abfb678f150}{CollapseCallbackCookie}};}
\DoxyCodeLine{92 }
\DoxyCodeLine{97   \textcolor{keyword}{typedef} \textcolor{keyword}{typename} std::list<PropagateCallback>::iterator \mbox{\hyperlink{classSolver_ace4c0aafb91c3db2531d97fe61d8afb7}{PropagateCallbackCookie}};}
\DoxyCodeLine{98 }
\DoxyCodeLine{104   \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>}
\DoxyCodeLine{105   \mbox{\hyperlink{classSolver_ab9943f77531798a2f6ce24b8281d71a3}{Solver}}(\textcolor{keyword}{const} std::vector<T>\& tiles, \textcolor{keywordtype}{int} seed=0): seed(seed) \{}
\DoxyCodeLine{106     \textcolor{keywordflow}{for} (\mbox{\hyperlink{classSolver_a624d11307b449d2e13dee24ec5170eed}{TileKey}} k = 0; k < tiles.size(); k++) \{}
\DoxyCodeLine{107       this-\/>tiles.push\_back(k);}
\DoxyCodeLine{108     \}}
\DoxyCodeLine{109   \}}
\DoxyCodeLine{110 }
\DoxyCodeLine{116   \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>}
\DoxyCodeLine{117   \mbox{\hyperlink{classSolver_a7b00bb931fe601491c521d6176cf77b5}{Solver}}(\textcolor{keyword}{const} std::map<TileKey, T>\& tiles, \textcolor{keywordtype}{int} seed=0): seed(seed) \{}
\DoxyCodeLine{118     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} [k, \_] : tiles) \{}
\DoxyCodeLine{119       this-\/>tiles.push\_back(k);}
\DoxyCodeLine{120     \}}
\DoxyCodeLine{121   \}}
\DoxyCodeLine{122 }
\DoxyCodeLine{123   \textcolor{comment}{/*}}
\DoxyCodeLine{124 \textcolor{comment}{   SOLVER API}}
\DoxyCodeLine{125 \textcolor{comment}{  */}}
\DoxyCodeLine{126 }
\DoxyCodeLine{131   \textcolor{keywordtype}{void} \mbox{\hyperlink{classSolver_a34198a1963bea018d0d7096dd36e3653}{setSeed}}(\textcolor{keywordtype}{int} seed);}
\DoxyCodeLine{132 }
\DoxyCodeLine{137   \textcolor{keywordtype}{int} \mbox{\hyperlink{classSolver_a010ed819d6b21696564a5cc5cd5e2cbb}{getSeed}}();}
\DoxyCodeLine{138   }
\DoxyCodeLine{146   std::shared\_ptr<Grid<TileKey>> \mbox{\hyperlink{classSolver_a7d7406c53eecaf19b82b312791d8fcb0}{solve}}(\textcolor{keywordtype}{size\_t} N);}
\DoxyCodeLine{147 }
\DoxyCodeLine{155   \textcolor{keywordtype}{void} \mbox{\hyperlink{classSolver_a7d7406c53eecaf19b82b312791d8fcb0}{solve}}(\textcolor{keywordtype}{size\_t} N, \mbox{\hyperlink{classGrid}{Grid<TileKey>}}\& grid);}
\DoxyCodeLine{156 }
\DoxyCodeLine{157   \textcolor{comment}{/*}}
\DoxyCodeLine{158 \textcolor{comment}{   CONSTRAINT INTERFACE/API}}
\DoxyCodeLine{159 \textcolor{comment}{   Set the solver constraints using this specified interface}}
\DoxyCodeLine{160 \textcolor{comment}{  */}}
\DoxyCodeLine{161 }
\DoxyCodeLine{178   \textcolor{keywordtype}{void} \mbox{\hyperlink{classSolver_ae9e645865467108124343029fcd91504}{addAdjacencyConstraint}}(TileKey t, Direction d, TileKey neighbor);}
\DoxyCodeLine{179 }
\DoxyCodeLine{190   \textcolor{keywordtype}{void} \mbox{\hyperlink{classSolver_ac103dc80c8f2e6b8f96d6890c7e0f1e8}{removeAdjacencyConstraint}}(TileKey t, Direction d, TileKey neighbor);}
\DoxyCodeLine{191 }
\DoxyCodeLine{203   \textcolor{keywordtype}{void} \mbox{\hyperlink{classSolver_ae9e645865467108124343029fcd91504}{addAdjacencyConstraint}}(TileKey t, Direction d, std::initializer\_list<TileKey> neighbors);}
\DoxyCodeLine{204 }
\DoxyCodeLine{216   \textcolor{keywordtype}{void} \mbox{\hyperlink{classSolver_ac103dc80c8f2e6b8f96d6890c7e0f1e8}{removeAdjacencyConstraint}}(TileKey t, Direction d, std::initializer\_list<TileKey> neighbors);}
\DoxyCodeLine{217 }
\DoxyCodeLine{232   \textcolor{keywordtype}{void} \mbox{\hyperlink{classSolver_a30173570fd36893e302f9313fe030937}{setInitialConstraint}}(\mbox{\hyperlink{structPosition}{Position}} p, TileKey possibility);}
\DoxyCodeLine{233 }
\DoxyCodeLine{242   \textcolor{keywordtype}{void} \mbox{\hyperlink{classSolver_a30173570fd36893e302f9313fe030937}{setInitialConstraint}}(\mbox{\hyperlink{structPosition}{Position}} p, std::initializer\_list<TileKey> possibilities);}
\DoxyCodeLine{243   }
\DoxyCodeLine{244   \textcolor{comment}{/*}}
\DoxyCodeLine{245 \textcolor{comment}{   CALLBACK INTERFACE/API}}
\DoxyCodeLine{246 \textcolor{comment}{  */}}
\DoxyCodeLine{247  }
\DoxyCodeLine{259   \mbox{\hyperlink{classSolver_abc55f3b23ccda7c353df7abfb678f150}{CollapseCallbackCookie}} \mbox{\hyperlink{classSolver_aa21bdaffa17e0ef52e78ce64f2046b5b}{registerOnCollapse}}(CollapseCallback callback);}
\DoxyCodeLine{260 }
\DoxyCodeLine{268   \textcolor{keywordtype}{void} \mbox{\hyperlink{classSolver_acbca26de9fca6d061d0478dda6cc64f1}{deregisterOnCollapse}}(\mbox{\hyperlink{classSolver_abc55f3b23ccda7c353df7abfb678f150}{CollapseCallbackCookie}} cookie);}
\DoxyCodeLine{269 }
\DoxyCodeLine{281   \mbox{\hyperlink{classSolver_ace4c0aafb91c3db2531d97fe61d8afb7}{PropagateCallbackCookie}} \mbox{\hyperlink{classSolver_aed54210e84c73fff7fb4f2be1e965457}{registerOnPropagate}}(PropagateCallback callback);}
\DoxyCodeLine{282 }
\DoxyCodeLine{290   \textcolor{keywordtype}{void} \mbox{\hyperlink{classSolver_acbca26de9fca6d061d0478dda6cc64f1}{deregisterOnCollapse}}(\mbox{\hyperlink{classSolver_ace4c0aafb91c3db2531d97fe61d8afb7}{PropagateCallbackCookie}} cookie);}
\DoxyCodeLine{291 }
\DoxyCodeLine{292   \textcolor{comment}{/*}}
\DoxyCodeLine{293 \textcolor{comment}{   COLLAPSE INTERFACE}}
\DoxyCodeLine{294 \textcolor{comment}{  */}}
\DoxyCodeLine{295 }
\DoxyCodeLine{303   \textcolor{keywordtype}{void} \mbox{\hyperlink{classSolver_a8b11638a34e8929a126607edbb125898}{setCollapseBehaviour}}(std::optional<CollapseBehavior> b);}
\DoxyCodeLine{304 }
\DoxyCodeLine{305 }
\DoxyCodeLine{306 \textcolor{keyword}{private}:}
\DoxyCodeLine{307   \textcolor{keyword}{typedef} std::pair<TileKey, Direction> Side;}
\DoxyCodeLine{308 }
\DoxyCodeLine{309   \textcolor{comment}{/* INITIAL */}}
\DoxyCodeLine{310   \textcolor{keywordtype}{int} seed;}
\DoxyCodeLine{311   std::vector<TileKey> tiles;}
\DoxyCodeLine{312 }
\DoxyCodeLine{313   \textcolor{comment}{/* CONSTRAINTS */}}
\DoxyCodeLine{314   std::unordered\_map<Side, std::unordered\_set<TileKey>> adjacency\_constraints;}
\DoxyCodeLine{315   std::unordered\_map<Position, std::unordered\_set<TileKey>> initial\_constraints;}
\DoxyCodeLine{316 }
\DoxyCodeLine{317   \textcolor{comment}{/* BEHAVIOURS */}}
\DoxyCodeLine{318   CollapseBehavior collapse\_behavior = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{319 }
\DoxyCodeLine{320   \textcolor{comment}{/* CALLBACKS */}}
\DoxyCodeLine{321   std::list<CollapseCallback> collapse\_callbacks;}
\DoxyCodeLine{322   std::list<PropagateCallback> propagate\_callbacks;}
\DoxyCodeLine{323 }
\DoxyCodeLine{324   \textcolor{comment}{/* ALGORITHM */}}
\DoxyCodeLine{325   std::unordered\_map<Position, std::vector<TileKey>> grid;}
\DoxyCodeLine{326   \textcolor{keywordtype}{size\_t} N;}
\DoxyCodeLine{327 }
\DoxyCodeLine{328   \textcolor{keywordtype}{void} initializeGrid(\textcolor{keywordtype}{size\_t} N);}
\DoxyCodeLine{329   \textcolor{keywordtype}{void} processInitialConstraints() ;}
\DoxyCodeLine{330   \textcolor{keywordtype}{bool} isCollapsed();}
\DoxyCodeLine{331   \textcolor{keywordtype}{bool} isContradiction();}
\DoxyCodeLine{332   \textcolor{keywordtype}{void} iterate();}
\DoxyCodeLine{333   \mbox{\hyperlink{structPosition}{Position}} getMinEntropyCoordinates();}
\DoxyCodeLine{334   \textcolor{keywordtype}{void} collapseAt(\mbox{\hyperlink{structPosition}{Position}} p);}
\DoxyCodeLine{335   \textcolor{keywordtype}{void} propagate(\mbox{\hyperlink{structPosition}{Position}} p);}
\DoxyCodeLine{336   \textcolor{keywordtype}{bool} propagateAt(\mbox{\hyperlink{structPosition}{Position}} current, \mbox{\hyperlink{structPosition}{Position}} neighbor); \textcolor{comment}{//returns true if neighbor's possible tiles decrease}}
\DoxyCodeLine{337   std::vector<Position> getNeighbors(\mbox{\hyperlink{structPosition}{Position}} p);}
\DoxyCodeLine{338   std::vector<TileKey>::const\_iterator collapseRandom(\textcolor{keyword}{const} std::vector<TileKey>\& tiles);}
\DoxyCodeLine{339   std::unordered\_set<TileKey> getAdjacencies(TileKey k, Direction d);}
\DoxyCodeLine{340   std::vector<TileKey> getPossibleTiles(\mbox{\hyperlink{structPosition}{Position}} p);}
\DoxyCodeLine{341 }
\DoxyCodeLine{342 }
\DoxyCodeLine{343 \};}
\DoxyCodeLine{344 }

\end{DoxyCode}
